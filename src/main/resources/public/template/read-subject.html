
<h2 class="upper-title">[[subject.title]]</h2>
<a ng-click="closeSubject()" class="row"><i18n>forum.back.to.subjects</i18n></a>
<hr />


<div ng-repeat="message in messages.all">
	<div class="row vertical-spacing"></div>
	<div class="illustrated-article">
		<div class="illustration" ng-click="viewAuthor(message)">
			<div class="image">
				<img ng-src="/userbook/avatar/[[message.author.id]]" />
			</div>
			<legend>
				<strong><a href="/userbook/annuaire/[[message.author.id]]">[[message.author.username]]</a></strong>
				<br />[[date.calendar(message.publicationDate)]]
			</legend>
		</div>
		<article class="illustrated-text" ng-if="message !== editedMessage">
			<span class="right-magnet small-text" ng-if="me.userId === message.author.id">
				<a ng-click="removeMessage(message)">
					<i18n>forum.remove</i18n>
				</a>
				<i18n>forum.or</i18n>
				<a ng-click="editMessage(message)">
					<i18n>forum.edit</i18n>
				</a>
			</span>
			<p bind-html="message.content"></p>

			<div class="row"></div>
		</article>
		<article class="illustrated-text" ng-if="message === editedMessage">
			<html-editor ng-model="editedMessage.content"></html-editor>
			<div class="row">
				<button class="right-magnet" ng-click="saveEditMessage()"><i18n>edit</i18n></button>
				<input type="button" class="cancel right-magnet" i18n-value="cancel" ng-click="cancelEditMessage()" />
			</div>
		</article>
	</div>

</div>

<div class="row" ng-if="!subject.locked && !editedMessage._id">
	<h2><i18n>reply</i18n></h2>
	<article class="twelve cell">
		<html-editor ng-model="editedMessage.content" watch-collections="['messages.all']"></html-editor>
		<button class="right-magnet" ng-click="addMessage()"><i18n>reply</i18n></button>
	</article>
</div>